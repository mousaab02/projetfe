---
- name: DEBUG | On est bien dans le r√¥le monitoring
  debug:
    msg: "üöÄ Le r√¥le monitoring est en cours d'ex√©cution"

- name: V√©rifier si la collection Docker est d√©j√† install√©e
  stat:
    path: /root/.ansible/collections/ansible_collections/community/docker
  register: docker_collection_installed

- name: Installer la collection community.docker si elle n‚Äôest pas pr√©sente
  shell: ansible-galaxy collection install community.docker
  when: not docker_collection_installed.stat.exists

- name: Cr√©er un dossier /opt/monitoring sur la VM
  file:
    path: /opt/monitoring
    state: directory
    mode: '0755'

- name: Copier docker-compose.yml
  copy:
    src: docker-compose.yml
    dest: /opt/monitoring/docker-compose.yml

- name: Copier prometheus.yml
  copy:
    src: prometheus.yml
    dest: /opt/monitoring/prometheus.yml

- name: Lancer les containers Prometheus et Node Exporter
  community.docker.docker_compose:
    project_src: /opt/monitoring
    state: present
